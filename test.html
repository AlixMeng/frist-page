<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>功能测试</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #1a1a2e; color: white; }
        .test-section { margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; }
        .pass { color: #4ade80; }
        .fail { color: #f87171; }
        pre { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Alix go 功能测试</h1>
    
    <div class="test-section">
        <h2>页面加载测试</h2>
        <div id="load-test">测试页面加载...</div>
    </div>
    
    <div class="test-section">
        <h2>JavaScript 错误日志</h2>
        <pre id="error-log">暂无错误</pre>
    </div>
    
    <div class="test-section">
        <h2>控制台输出</h2>
        <pre id="console-log">等待输出...</pre>
    </div>
    
    <div class="test-section">
        <h2>操作</h2>
        <button onclick="clearStorage()">清除本地存储</button>
        <button onclick="testMainPage()">在新窗口打开主页</button>
        <div id="storage-status"></div>
    </div>

    <script>
        const errors = [];
        const logs = [];
        
        // 捕获错误
        window.onerror = function(msg, url, line, col, error) {
            const err = `[${line}:${col}] ${msg}`;
            errors.push(err);
            document.getElementById('error-log').textContent = errors.join('\n');
            return false;
        };
        
        // 捕获控制台日志
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            logs.push('[LOG] ' + args.join(' '));
            updateLog();
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            logs.push('[ERROR] ' + args.join(' '));
            updateLog();
            originalError.apply(console, args);
        };
        
        function updateLog() {
            document.getElementById('console-log').textContent = logs.join('\n');
        }
        
        // 页面加载测试
        window.onload = function() {
            document.getElementById('load-test').innerHTML = '<span class="pass">✓ 页面加载成功</span>';
            console.log('测试页面加载完成');
        };
        
        // 清除存储
        function clearStorage() {
            try {
                localStorage.clear();
                document.getElementById('storage-status').innerHTML = '<span class="pass">✓ 本地存储已清除</span>';
                console.log('本地存储已清除');
            } catch(e) {
                document.getElementById('storage-status').innerHTML = '<span class="fail">✗ 错误: ' + e.message + '</span>';
            }
        }
        
        // 打开主页
        function testMainPage() {
            window.open('/index.html', '_blank');
        }
        
        // 检查主页状态
        fetch('/index.html')
            .then(r => {
                console.log('主页可访问, 状态:', r.status);
                return r.text();
            })
            .then(text => {
                console.log('主页大小:', text.length, '字节');
                
                // 检查关键函数
                const checks = [
                    ['renderApps', text.includes('function renderApps')],
                    ['renderFavorites', text.includes('function renderFavorites')],
                    ['updateDateTime', text.includes('function updateDateTime')],
                    ['getWeather', text.includes('function getWeather')],
                    ['loadQuotes', text.includes('function loadQuotes')],
                    ['renderGallery', text.includes('function renderGallery')],
                ];
                
                checks.forEach(([name, exists]) => {
                    console.log(`${name}: ${exists ? '存在' : '缺失'}`);
                });
            })
            .catch(e => {
                console.error('获取主页失败:', e.message);
            });
    </script>
</body>
</html>